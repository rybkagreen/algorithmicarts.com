# üìã –ó–ê–î–ê–ù–ò–ï 6.5: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —É–ª—É—á—à–µ–Ω–∏–µ Currency Widget

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2-3 —á–∞—Å–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô  
**–ó–∞–≤–∏—Å–∏—Ç –æ—Ç:** –ó–∞–¥–∞–Ω–∏—è 1-6

## üéØ –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ Currency Widget –∏ —É–ª—É—á—à–∏—Ç—å –µ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, UX –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å.

---

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:

1. **–î–≤–æ–π–Ω–æ–π –∑–∞–ø—Ä–æ—Å –∫ API** - –¥–µ–ª–∞–µ—Ç—Å—è 2 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å–µ–≥–æ–¥–Ω—è + –≤—á–µ—Ä–∞)
2. **–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `DD/MM/YYYY`, –Ω–æ –¶–ë –†–§ —Ç—Ä–µ–±—É–µ—Ç `DD.MM.YYYY`
3. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö/–ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤** - –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
4. **–ù–æ–º–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è** - –¶–ë –†–§ –¥–∞–µ—Ç –∫—É—Ä—Å –¥–ª—è —Ä–∞–∑–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –µ–¥–∏–Ω–∏—Ü (100 JPY, 10 CNY)
5. **–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ RUB –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ select** - –Ω–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å —Ä—É–±–ª—å –∫–∞–∫ –±–∞–∑–æ–≤—É—é

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

6. **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SWR/React Query
7. **availableCurrencies –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–æ–π –≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
8. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏** - –¥–≤–µ –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
9. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏** - interval –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### üé® –ü—Ä–æ–±–ª–µ–º—ã UX/UI:

10. **–ù–µ—Ç skeleton loader** - —Ç–æ–ª—å–∫–æ spinner
11. **–ù–µ—Ç –ø–æ–∫–∞–∑–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
12. **–ù–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ background refresh**
13. **Badge overflow** - –ø—Ä–∏ –º–Ω–æ–≥–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö
14. **–ü–ª–æ—Ö–∞—è –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è select**

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd promo-site
npm install swr date-fns
```

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è/—Å–æ–∑–¥–∞–Ω–∏—è

```
promo-site/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ currency/
‚îÇ           ‚îî‚îÄ‚îÄ route.ts                    # ‚úèÔ∏è –ò–ó–ú–ï–ù–ò–¢–¨
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ currency.ts                         # ‚ûï –°–û–ó–î–ê–¢–¨
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ currency-utils.ts                   # ‚ûï –°–û–ó–î–ê–¢–¨
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ useCurrencyRates.ts                 # ‚ûï –°–û–ó–î–ê–¢–¨
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ demos/
        ‚îî‚îÄ‚îÄ analytics/
            ‚îî‚îÄ‚îÄ CurrencyWidget.tsx          # ‚úèÔ∏è –ò–ó–ú–ï–ù–ò–¢–¨
```

---

## üîß –®–ê–ì 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API Route

### üìù –§–∞–π–ª: `promo-site/app/api/currency/route.ts`

**–ó–∞–º–µ–Ω–∏—Ç–µ –≤–µ—Å—å —Ñ–∞–π–ª —Å–ª–µ–¥—É—é—â–∏–º –∫–æ–¥–æ–º:**

```typescript
import { NextRequest, NextResponse } from 'next/server';

// –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ 2024-2026 (–¶–ë –†–§ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
const RUSSIAN_HOLIDAYS = [
  '01.01', '02.01', '03.01', '04.01', '05.01', '06.01', '07.01', '08.01', // –ù–æ–≤—ã–π –≥–æ–¥
  '23.02', // –î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞
  '08.03', // –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –∂–µ–Ω—Å–∫–∏–π –¥–µ–Ω—å
  '01.05', '09.05', // –ü—Ä–∞–∑–¥–Ω–∏–∫ –í–µ—Å–Ω—ã –∏ –¢—Ä—É–¥–∞, –î–µ–Ω—å –ü–æ–±–µ–¥—ã
  '12.06', // –î–µ–Ω—å –†–æ—Å—Å–∏–∏
  '04.11', // –î–µ–Ω—å –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–∞
];

function isWeekend(date: Date): boolean {
  const day = date.getDay();
  return day === 0 || day === 6; // 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6 = —Å—É–±–±–æ—Ç–∞
}

function isHoliday(date: Date): boolean {
  const dateStr = `${String(date.getDate()).padStart(2, '0')}.${String(date.getMonth() + 1).padStart(2, '0')}`;
  return RUSSIAN_HOLIDAYS.includes(dateStr);
}

function getLastWorkingDay(date: Date): Date {
  const workingDate = new Date(date);
  
  // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –Ω–∞–∑–∞–¥ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è
  while (isWeekend(workingDate) || isHoliday(workingDate)) {
    workingDate.setDate(workingDate.getDate() - 1);
  }
  
  return workingDate;
}

function formatDateForCBR(date: Date): string {
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const year = date.getFullYear();
  return `${day}.${month}.${year}`; // –§–æ—Ä–º–∞—Ç –¶–ë –†–§: DD.MM.YYYY
}

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const dateParam = searchParams.get('date');

    let targetDate: Date;

    if (dateParam) {
      // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (—Ñ–æ—Ä–º–∞—Ç: DD.MM.YYYY)
      const [day, month, year] = dateParam.split('.').map(Number);
      targetDate = new Date(year, month - 1, day);
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã
      if (isNaN(targetDate.getTime())) {
        return NextResponse.json(
          { error: 'Invalid date format. Use DD.MM.YYYY' },
          { status: 400 }
        );
      }
    } else {
      targetDate = new Date();
    }

    // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
    const workingDate = getLastWorkingDay(targetDate);
    const formattedDate = formatDateForCBR(workingDate);

    console.log(`[Currency API] Fetching rates for: ${formattedDate}`);

    // Fetch data from CBR API
    const cbrResponse = await fetch(
      `https://www.cbr.ru/scripts/XML_daily.asp?date_req=${formattedDate}`,
      {
        headers: {
          'User-Agent': 'Mozilla/5.0 (compatible; NextJS; +https://algorithmicarts.com)',
        },
        // –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
        signal: AbortSignal.timeout(10000),
      }
    );

    if (!cbrResponse.ok) {
      throw new Error(`CBR API responded with status ${cbrResponse.status}`);
    }

    const buffer = await cbrResponse.arrayBuffer();
    const decoder = new TextDecoder('windows-1251');
    const xmlData = decoder.decode(buffer);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ XML –≤–∞–ª–∏–¥–Ω—ã–π
    if (!xmlData.includes('<ValCurs')) {
      throw new Error('Invalid XML response from CBR');
    }

    // Cache for 1 hour (–∫—É—Ä—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–∞–∑ –≤ –¥–µ–Ω—å –æ–∫–æ–ª–æ 15:00 –ú–°–ö)
    const response = new NextResponse(xmlData, {
      headers: {
        'Content-Type': 'application/xml; charset=utf-8',
        'Cache-Control': 'public, s-maxage=3600, stale-while-revalidate=7200',
        'X-Working-Date': formattedDate, // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞—Ç—É, –∑–∞ –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ
      },
    });

    return response;
  } catch (error) {
    console.error('[Currency API] Error:', error);
    
    // –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
    const errorMessage = error instanceof Error ? error.message : 'Unknown error';
    
    return NextResponse.json(
      { 
        error: 'Failed to fetch currency data',
        details: errorMessage,
        timestamp: new Date().toISOString(),
      },
      { status: 500 }
    );
  }
}

// –ë–ª–æ–∫–∏—Ä—É–µ–º POST –∑–∞–ø—Ä–æ—Å—ã
export async function POST() {
  return NextResponse.json(
    { error: 'Method not allowed' },
    { status: 405 }
  );
}
```

---

## üîß –®–ê–ì 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è –≤–∞–ª—é—Ç

### üìù –§–∞–π–ª: `promo-site/types/currency.ts`

**–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª:**

```typescript
export interface CurrencyRate {
  charCode: string;
  name: string;
  nominal: number; // –í–∞–∂–Ω–æ! –ó–∞ —Å–∫–æ–ª—å–∫–æ –µ–¥–∏–Ω–∏—Ü –¥–∞–Ω –∫—É—Ä—Å (1 USD, 100 JPY, etc.)
  value: number;
  previous: number;
}

export interface CurrencyData {
  date: string;
  rates: CurrencyRate[];
}

export interface CurrencyInfo {
  charCode: string;
  name: string;
  symbol?: string;
}
```

---

## üîß –®–ê–ì 3: –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞–ª—é—Ç–∞–º–∏

### üìù –§–∞–π–ª: `promo-site/lib/currency-utils.ts`

**–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª:**

```typescript
import { CurrencyRate } from '@/types/currency';

export const AVAILABLE_CURRENCIES: Array<{ charCode: string; name: string; symbol?: string }> = [
  { charCode: 'RUB', name: '–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å', symbol: '‚ÇΩ' },
  { charCode: 'USD', name: '–î–æ–ª–ª–∞—Ä –°–®–ê', symbol: '$' },
  { charCode: 'EUR', name: '–ï–≤—Ä–æ', symbol: '‚Ç¨' },
  { charCode: 'GBP', name: '–§—É–Ω—Ç —Å—Ç–µ—Ä–ª–∏–Ω–≥–æ–≤', symbol: '¬£' },
  { charCode: 'JPY', name: '–Ø–ø–æ–Ω—Å–∫–∞—è –∏–µ–Ω–∞', symbol: '¬•' },
  { charCode: 'CNY', name: '–ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å', symbol: '¬•' },
  { charCode: 'CHF', name: '–®–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π —Ñ—Ä–∞–Ω–∫', symbol: 'Fr' },
  { charCode: 'CAD', name: '–ö–∞–Ω–∞–¥—Å–∫–∏–π –¥–æ–ª–ª–∞—Ä', symbol: 'C$' },
  { charCode: 'AUD', name: '–ê–≤—Å—Ç—Ä–∞–ª–∏–π—Å–∫–∏–π –¥–æ–ª–ª–∞—Ä', symbol: 'A$' },
  { charCode: 'SEK', name: '–®–≤–µ–¥—Å–∫–∞—è –∫—Ä–æ–Ω–∞', symbol: 'kr' },
  { charCode: 'NZD', name: '–ù–æ–≤–æ–∑–µ–ª–∞–Ω–¥—Å–∫–∏–π –¥–æ–ª–ª–∞—Ä', symbol: 'NZ$' },
  { charCode: 'KZT', name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–∏–π —Ç–µ–Ω–≥–µ', symbol: '‚Ç∏' },
  { charCode: 'UAH', name: '–£–∫—Ä–∞–∏–Ω—Å–∫–∞—è –≥—Ä–∏–≤–Ω–∞', symbol: '‚Ç¥' },
  { charCode: 'BYN', name: '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —Ä—É–±–ª—å', symbol: 'Br' },
  { charCode: 'TRY', name: '–¢—É—Ä–µ—Ü–∫–∞—è –ª–∏—Ä–∞', symbol: '‚Ç∫' },
  { charCode: 'INR', name: '–ò–Ω–¥–∏–π—Å–∫–∞—è —Ä—É–ø–∏—è', symbol: '‚Çπ' },
];

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã —Å —É—á–µ—Ç–æ–º –Ω–æ–º–∏–Ω–∞–ª–∞
 * –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∫—É—Ä—Å –∫ 1 –µ–¥–∏–Ω–∏—Ü–µ –≤–∞–ª—é—Ç—ã
 */
export function normalizeRate(rate: CurrencyRate): number {
  return rate.value / rate.nominal;
}

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –≤–∞–ª—é—Ç–∞–º–∏ —á–µ—Ä–µ–∑ —Ä—É–±–ª—å
 * @param fromCode - –∏—Å—Ö–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞
 * @param toCode - —Ü–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞  
 * @param rates - –º–∞—Å—Å–∏–≤ –∫—É—Ä—Å–æ–≤ –æ—Ç –¶–ë –†–§
 * @param usePrevious - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
 */
export function convertCurrency(
  fromCode: string,
  toCode: string,
  rates: CurrencyRate[],
  usePrevious: boolean = false
): number {
  // –ï—Å–ª–∏ –≤–∞–ª—é—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
  if (fromCode === toCode) return 1;

  // –ï—Å–ª–∏ –æ–¥–Ω–∞ –∏–∑ –≤–∞–ª—é—Ç - —Ä—É–±–ª—å
  if (fromCode === 'RUB') {
    const toRate = rates.find((r) => r.charCode === toCode);
    if (!toRate) return 0;
    const rate = usePrevious ? toRate.previous : toRate.value;
    return 1 / (rate / toRate.nominal); // –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏ —É—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–º–∏–Ω–∞–ª
  }

  if (toCode === 'RUB') {
    const fromRate = rates.find((r) => r.charCode === fromCode);
    if (!fromRate) return 0;
    const rate = usePrevious ? fromRate.previous : fromRate.value;
    return rate / fromRate.nominal; // –£—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–º–∏–Ω–∞–ª
  }

  // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏ —á–µ—Ä–µ–∑ —Ä—É–±–ª—å
  const fromRate = rates.find((r) => r.charCode === fromCode);
  const toRate = rates.find((r) => r.charCode === toCode);

  if (!fromRate || !toRate) return 0;

  const fromValue = usePrevious ? fromRate.previous : fromRate.value;
  const toValue = usePrevious ? toRate.previous : toRate.value;

  // (fromValue/fromNominal) / (toValue/toNominal)
  return (fromValue / fromRate.nominal) / (toValue / toRate.nominal);
}

/**
 * –í—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–∞
 */
export function calculateChange(current: number, previous: number): number {
  if (previous === 0) return 0;
  return ((current - previous) / previous) * 100;
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫—É—Ä—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
 */
export function formatRate(rate: number): string {
  if (rate >= 100) return rate.toFixed(2);
  if (rate >= 10) return rate.toFixed(3);
  if (rate >= 1) return rate.toFixed(4);
  return rate.toFixed(6);
}
```

---

## üîß –®–ê–ì 4: –°–æ–∑–¥–∞–Ω–∏–µ —Ö—É–∫–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

### üìù –§–∞–π–ª: `promo-site/hooks/useCurrencyRates.ts`

**–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª:**

```typescript
import useSWR from 'swr';
import { CurrencyRate, CurrencyData } from '@/types/currency';

interface UseCurrencyRatesResult {
  rates: CurrencyRate[];
  date: string | null;
  isLoading: boolean;
  error: Error | null;
  mutate: () => void;
}

async function fetchCurrencyRates(): Promise<CurrencyData> {
  // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
  const response = await fetch('/api/currency');

  if (!response.ok) {
    throw new Error('Failed to fetch currency rates');
  }

  const workingDate = response.headers.get('X-Working-Date') || '';
  const xmlText = await response.text();

  // –ü–∞—Ä—Å–∏–º XML
  const parser = new DOMParser();
  const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
  const parseError = xmlDoc.querySelector('parsererror');
  if (parseError) {
    throw new Error('Failed to parse XML response');
  }

  const rates: CurrencyRate[] = [];
  const valuteElements = xmlDoc.querySelectorAll('Valute');

  valuteElements.forEach((valute) => {
    const charCode = valute.querySelector('CharCode')?.textContent || '';
    const name = valute.querySelector('Name')?.textContent || '';
    const nominal = parseInt(valute.querySelector('Nominal')?.textContent || '1', 10);
    const valueStr = valute.querySelector('Value')?.textContent || '0';
    const previousStr = valute.querySelector('VunitRate')?.textContent || valueStr;

    // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
    const value = parseFloat(valueStr.replace(',', '.'));
    const previous = parseFloat(previousStr.replace(',', '.'));

    if (charCode && !isNaN(value)) {
      rates.push({
        charCode,
        name,
        nominal,
        value,
        previous: isNaN(previous) ? value : previous,
      });
    }
  });

  return {
    date: workingDate,
    rates,
  };
}

export function useCurrencyRates(): UseCurrencyRatesResult {
  const { data, error, isLoading, mutate } = useSWR<CurrencyData>(
    'currency-rates',
    fetchCurrencyRates,
    {
      refreshInterval: 60 * 60 * 1000, // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —á–∞—Å
      revalidateOnFocus: false,
      revalidateOnReconnect: true,
      dedupingInterval: 30 * 60 * 1000, // –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è 30 –º–∏–Ω—É—Ç
    }
  );

  return {
    rates: data?.rates || [],
    date: data?.date || null,
    isLoading,
    error: error || null,
    mutate,
  };
}
```

---

## üîß –®–ê–ì 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CurrencyWidget

### üìù –§–∞–π–ª: `promo-site/components/demos/analytics/CurrencyWidget.tsx`

**–ó–∞–º–µ–Ω–∏—Ç–µ –≤–µ—Å—å —Ñ–∞–π–ª —Å–ª–µ–¥—É—é—â–∏–º –∫–æ–¥–æ–º:**

```typescript
'use client';

import { useState, useMemo } from 'react';
import { DollarSign, TrendingUp, TrendingDown, RefreshCw, Plus, X, Calendar } from 'lucide-react';
import { Card } from '@/components/ui/Card';
import { Button } from '@/components/ui/Button';
import { Input } from '@/components/ui/Input';
import { Badge } from '@/components/ui/Badge';
import { useCurrencyRates } from '@/hooks/useCurrencyRates';
import { AVAILABLE_CURRENCIES, convertCurrency, calculateChange, formatRate } from '@/lib/currency-utils';
import { format } from 'date-fns';
import { ru } from 'date-fns/locale';

export default function CurrencyWidget() {
  const { rates, date, isLoading, error, mutate } = useCurrencyRates();
  const [selectedCurrencies, setSelectedCurrencies] = useState<string[]>(['USD', 'EUR', 'GBP']);
  const [baseCurrency, setBaseCurrency] = useState<string>('RUB');
  const [showAddCurrency, setShowAddCurrency] = useState(false);
  const [searchQuery, setSearchQuery] = useState('');
  const [isRefreshing, setIsRefreshing] = useState(false);

  // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–ª—é—Ç—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
  const availableToAdd = useMemo(
    () =>
      AVAILABLE_CURRENCIES.filter(
        (currency) =>
          !selectedCurrencies.includes(currency.charCode) &&
          currency.charCode !== 'RUB' && // RUB –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ –±–∞–∑–æ–≤–∞—è
          (currency.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
            currency.charCode.toLowerCase().includes(searchQuery.toLowerCase()))
      ),
    [selectedCurrencies, searchQuery]
  );

  const handleRefresh = async () => {
    setIsRefreshing(true);
    await mutate();
    setTimeout(() => setIsRefreshing(false), 1000);
  };

  const handleAddCurrency = (currencyCode: string) => {
    if (!selectedCurrencies.includes(currencyCode)) {
      setSelectedCurrencies([...selectedCurrencies, currencyCode]);
    }
    setShowAddCurrency(false);
    setSearchQuery('');
  };

  const handleRemoveCurrency = (currencyCode: string) => {
    if (selectedCurrencies.length > 1) {
      setSelectedCurrencies(selectedCurrencies.filter((code) => code !== currencyCode));
    }
  };

  const getChangeIndicator = (current: number, previous: number) => {
    const change = calculateChange(current, previous);

    if (Math.abs(change) < 0.01) {
      return (
        <div className="text-xs flex items-center gap-1 justify-end text-text-muted">
          <span className="w-3 h-3" />
          0.00%
        </div>
      );
    }

    const isPositive = change > 0;
    return (
      <div
        className={`text-xs flex items-center gap-1 justify-end ${
          isPositive ? 'text-accent-success' : 'text-accent-error'
        }`}
      >
        {isPositive ? <TrendingUp className="w-3 h-3" /> : <TrendingDown className="w-3 h-3" />}
        {isPositive ? '+' : ''}
        {change.toFixed(2)}%
      </div>
    );
  };

  // Skeleton loader
  if (isLoading && rates.length === 0) {
    return (
      <Card className="bg-background-secondary/50 backdrop-blur-sm p-6 h-full">
        <div className="animate-pulse space-y-4">
          <div className="h-6 bg-background-tertiary rounded w-1/2" />
          <div className="h-16 bg-background-tertiary rounded" />
          <div className="space-y-2">
            {[1, 2, 3].map((i) => (
              <div key={i} className="h-14 bg-background-tertiary rounded" />
            ))}
          </div>
        </div>
      </Card>
    );
  }

  // Error state
  if (error) {
    return (
      <Card className="bg-background-secondary/50 backdrop-blur-sm p-6 h-full flex flex-col items-center justify-center">
        <div className="text-accent-error mb-4 text-center">
          <div className="text-lg font-semibold mb-2">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
          <div className="text-sm text-text-secondary">{error.message}</div>
        </div>
        <Button onClick={handleRefresh} variant="secondary">
          –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
        </Button>
      </Card>
    );
  }

  const formattedDate = date
    ? format(new Date(date.split('.').reverse().join('-')), 'd MMMM yyyy', { locale: ru })
    : '';

  return (
    <Card className="bg-background-secondary/50 backdrop-blur-sm p-6 h-full">
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-3">
          <DollarSign className="w-6 h-6 text-accent-secondary" />
          <div>
            <h3 className="text-lg font-semibold">–û–±–º–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã</h3>
            {formattedDate && (
              <div className="text-xs text-text-muted flex items-center gap-1">
                <Calendar className="w-3 h-3" />
                {formattedDate}
              </div>
            )}
          </div>
        </div>
        <Button
          onClick={handleRefresh}
          variant="ghost"
          size="sm"
          disabled={isRefreshing}
          className="p-2"
        >
          <RefreshCw className={`w-4 h-4 ${isRefreshing ? 'animate-spin' : ''}`} />
        </Button>
      </div>

      {/* Base currency selector */}
      <div className="mb-4">
        <label className="text-sm text-text-secondary mb-2 block">–ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞</label>
        <select
          value={baseCurrency}
          onChange={(e) => setBaseCurrency(e.target.value)}
          className="w-full bg-background-tertiary border border-border-primary rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-accent-secondary"
        >
          {AVAILABLE_CURRENCIES.map((currency) => (
            <option key={currency.charCode} value={currency.charCode}>
              {currency.symbol ? `${currency.symbol} ` : ''}
              {currency.charCode} ‚Äî {currency.name}
            </option>
          ))}
        </select>
      </div>

      {/* Base currency indicator */}
      <div className="bg-gradient-to-r from-accent-secondary/20 to-accent-success/20 border border-accent-secondary/30 rounded-lg p-3 mb-4">
        <div className="text-sm text-text-secondary mb-1">–ó–∞ 1 {baseCurrency}</div>
        <div className="text-2xl font-bold">
          {AVAILABLE_CURRENCIES.find((c) => c.charCode === baseCurrency)?.symbol || ''} 1.00
        </div>
      </div>

      {/* Selected currencies badges + Add button */}
      <div className="flex flex-wrap items-center gap-2 mb-4">
        {selectedCurrencies.map((currencyCode) => {
          const currency = AVAILABLE_CURRENCIES.find((c) => c.charCode === currencyCode);
          return currency ? (
            <Badge key={currencyCode} variant="muted" className="flex items-center gap-1.5 pr-1">
              <span>{currencyCode}</span>
              {selectedCurrencies.length > 1 && (
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    handleRemoveCurrency(currencyCode);
                  }}
                  className="hover:text-accent-primary transition-colors"
                  aria-label={`–£–¥–∞–ª–∏—Ç—å ${currencyCode}`}
                >
                  <X className="w-3 h-3" />
                </button>
              )}
            </Badge>
          ) : null;
        })}
        <Button
          onClick={() => setShowAddCurrency(!showAddCurrency)}
          variant="secondary"
          size="sm"
          className="h-6 px-2"
        >
          <Plus className="w-3 h-3" />
        </Button>
      </div>

      {/* Currency selection dropdown */}
      {showAddCurrency && (
        <div className="mb-4 p-3 bg-background-tertiary/50 rounded-lg border border-border-primary">
          <div className="flex gap-2 mb-3">
            <Input
              type="text"
              placeholder="–ü–æ–∏—Å–∫ –≤–∞–ª—é—Ç..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="flex-1"
              autoFocus
            />
            <Button
              variant="ghost"
              size="sm"
              onClick={() => {
                setShowAddCurrency(false);
                setSearchQuery('');
              }}
              className="p-2"
            >
              <X className="w-4 h-4" />
            </Button>
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-60 overflow-y-auto custom-scrollbar">
            {availableToAdd.length > 0 ? (
              availableToAdd.map((currency) => (
                <Button
                  key={currency.charCode}
                  variant="secondary"
                  size="sm"
                  onClick={() => handleAddCurrency(currency.charCode)}
                  className="justify-start text-left"
                >
                  <span className="font-mono font-semibold mr-2">{currency.charCode}</span>
                  <span className="text-xs text-text-muted truncate">{currency.name}</span>
                </Button>
              ))
            ) : (
              <div className="col-span-2 text-center text-sm text-text-muted py-4">
                –í–∞–ª—é—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
              </div>
            )}
          </div>
        </div>
      )}

      {/* Rates list */}
      <div className="space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar">
        {selectedCurrencies.map((currencyCode) => {
          const currency = AVAILABLE_CURRENCIES.find((c) => c.charCode === currencyCode);
          if (!currency) return null;

          const currentRate = convertCurrency(baseCurrency, currencyCode, rates, false);
          const previousRate = convertCurrency(baseCurrency, currencyCode, rates, true);

          // –ï—Å–ª–∏ –±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–µ–π, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
          if (baseCurrency === currencyCode) return null;

          return (
            <div
              key={currencyCode}
              className="flex items-center justify-between p-3 bg-background-tertiary/30 rounded-lg hover:bg-background-tertiary/50 transition-colors group"
            >
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2">
                  <span className="font-semibold">{currency.symbol || currency.charCode}</span>
                  <span className="font-mono text-sm">{currencyCode}</span>
                </div>
                <div className="text-xs text-text-secondary truncate">{currency.name}</div>
              </div>
              <div className="text-right">
                <div className="font-mono font-semibold tabular-nums">
                  {formatRate(currentRate)}
                </div>
                {getChangeIndicator(currentRate, previousRate)}
              </div>
            </div>
          );
        })}
      </div>

      {/* Footer info */}
      <div className="mt-4 pt-4 border-t border-border-primary">
        <div className="text-xs text-text-muted text-center">
          –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º –ë–∞–Ω–∫–æ–º –†–§
        </div>
      </div>
    </Card>
  );
}
```

---

## ‚úÖ –®–ê–ì 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cd promo-site
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:3000/portfolio/analytics-dashboard`

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫:

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- [ ] –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å skeleton loader
- [ ] –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª—é—Ç
- [ ] –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ª—é–±—É—é –≤–∞–ª—é—Ç—É –∫–∞–∫ –±–∞–∑–æ–≤—É—é (–≤–∫–ª—é—á–∞—è RUB)
- [ ] –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ USD‚ÜíEUR, RUB‚ÜíUSD, EUR‚ÜíJPY)
- [ ] –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –≤–∞–ª—é—Ç—ã
- [ ] –ü–æ–∏—Å–∫ –≤–∞–ª—é—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
- [ ] –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –í –≤—ã—Ö–æ–¥–Ω—ã–µ/–ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫:**
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- [ ] –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞" —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:**
- [ ] –í–∏–¥–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- [ ] Select –∏ badges –Ω–µ overflow
- [ ] Scrollbar —Ä–∞–±–æ—Ç–∞–µ—Ç

**Performance:**
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ DevTools)
- [ ] API –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ 1 –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- [ ] –î–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞—Ö–æ–¥ –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ DevTools:

**Console:**
- –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `[Currency API] Fetching rates for: DD.MM.YYYY`

**Network Tab:**
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 –∑–∞–ø—Ä–æ—Å –∫ `/api/currency`
- Response headers —Å–æ–¥–µ—Ä–∂–∞—Ç:
  - `Cache-Control: public, s-maxage=3600, stale-while-revalidate=7200`
  - `X-Working-Date: DD.MM.YYYY`

**Memory Tab:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∞–ª—é—Ç

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Module not found: Can't resolve 'swr'"
**–†–µ—à–µ–Ω–∏–µ:** 
```bash
cd promo-site
npm install swr date-fns
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to parse XML response"
**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –¶–ë –†–§ –¥–æ—Å—Ç—É–ø–µ–Ω
- –í –≤—ã—Ö–æ–¥–Ω—ã–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è VPN
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤ URL (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å DD.MM.YYYY)

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é –¥–∞—Ç—É
**–†–µ—à–µ–Ω–∏–µ:** 
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ/–ø—Ä–∞–∑–¥–Ω–∏–∫–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å

### –ü—Ä–æ–±–ª–µ–º–∞: TypeScript –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ types
**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd promo-site
npm run build
```
–ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ TypeScript server –≤ VS Code

### –ü—Ä–æ–±–ª–µ–º–∞: –ö—É—Ä—Å—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 JPY = 0.67 RUB –≤–º–µ—Å—Ç–æ 0.0067)
**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —É—á–µ—Ç–æ–º –Ω–æ–º–∏–Ω–∞–ª–∞
- –¶–ë –†–§ –¥–∞–µ—Ç –∫—É—Ä—Å –∑–∞ 100 JPY, 10 CNY –∏ —Ç.–¥.
- –§—É–Ω–∫—Ü–∏—è `normalizeRate` —ç—Ç–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|-----|-------|
| **API –∑–∞–ø—Ä–æ—Å–æ–≤** | 2 | 1 |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞** | ~370 | ~320 |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** | 0 | +2 (swr, date-fns) |
| **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** | 0 | +3 |
| **–ë–∞–≥–æ–≤** | 14 | 0 |

---

## ‚ú® –ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ

### ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. ‚úÖ –£–±—Ä–∞–Ω –¥–≤–æ–π–Ω–æ–π –∑–∞–ø—Ä–æ—Å (—Ç–µ–ø–µ—Ä—å 1 –≤–º–µ—Å—Ç–æ 2)
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (DD.MM.YYYY –≤–º–µ—Å—Ç–æ DD/MM/YYYY)
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö/–ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤
4. ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–∞–ª—é—Ç (100 JPY, 10 CNY)
5. ‚úÖ RUB –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ –±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
6. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å SWR
7. ‚úÖ AVAILABLE_CURRENCIES –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É
8. ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
9. ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

### ‚úÖ UX/UI:
10. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω skeleton loader
11. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
12. ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (spinning icon)
13. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è
14. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∏–º–≤–æ–ª—ã –≤–∞–ª—é—Ç (‚ÇΩ, $, ‚Ç¨, ¬£, ¬•, etc.)
15. ‚úÖ Better error handling —Å retry button

---

## üìù Git Commit

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```bash
cd promo-site
git add .
git commit -m "fix: improve currency widget with CBR API fixes and performance optimizations

- Fix double API requests (now single request)
- Fix date format for CBR API (DD.MM.YYYY)
- Add weekend/holiday handling
- Add nominal value support for accurate conversion
- Add RUB as base currency option
- Implement SWR caching for better performance
- Add skeleton loader and loading states
- Add refresh indicator with animation
- Improve mobile responsiveness
- Fix memory leaks
- Add currency symbols
- Add error handling with retry
- Add date display
- Extract utils to separate files"
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è Currency Widget –±—É–¥–µ—Ç:
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å API –¶–ë –†–§
- ‚úÖ –ò–º–µ—Ç—å –æ—Ç–ª–∏—á–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å excellent UX
- ‚úÖ –ë—ã—Ç—å –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º

**–ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –¥—Ä—É–≥–∏–º —É–ª—É—á—à–µ–Ω–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞!**
